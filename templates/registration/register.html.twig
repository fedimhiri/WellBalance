{# templates/frontend/register.html.twig #}
{% extends 'frontend/base_frontend.html.twig' %}

{% block title %}Créer un compte{% endblock %}

{% block body %}
<div class="auth-creative-wrapper py-5">
    <div class="container">
        <div class="card p-4">

            <h2 class="mb-3">Créer un compte</h2>
            <p class="text-muted mb-4">
                Inscrivez-vous pour accéder à votre espace patient.
            </p>

            {{ form_start(registrationForm) }}

            {{ form_errors(registrationForm) }}

            <!-- EMAIL -->
            <div class="mb-3">
                {{ form_widget(registrationForm.email, {
                    attr: { class: 'form-control', placeholder: 'Email' }
                }) }}
                {{ form_errors(registrationForm.email) }}
            </div>

            <!-- USERNAME -->
            <div class="mb-3">
                {{ form_widget(registrationForm.username, {
                    attr: { class: 'form-control', placeholder: 'Nom d’utilisateur' }
                }) }}
                {{ form_errors(registrationForm.username) }}
            </div>

            <!-- TELEPHONE -->
            <div class="mb-3">
                {{ form_widget(registrationForm.telephone, {
                    attr: { class: 'form-control', placeholder: 'Téléphone (8 chiffres)' }
                }) }}
                {{ form_errors(registrationForm.telephone) }}
            </div>

            <!-- MOT DE PASSE -->
            <div class="mb-3">
                {{ form_widget(registrationForm.plainPassword.first, {
                    attr: { class: 'form-control', placeholder: 'Mot de passe' }
                }) }}
            </div>

            <!-- CONFIRMATION -->
            <div class="mb-3">
                {{ form_widget(registrationForm.plainPassword.second, {
                    attr: { class: 'form-control', placeholder: 'Confirmer le mot de passe' }
                }) }}
                {{ form_errors(registrationForm.plainPassword) }}
            </div>

            <!-- CONDITIONS -->
            <div class="form-check mb-3">
                {{ form_widget(registrationForm.agreeTerms, {
                    attr: { class: 'form-check-input' }
                }) }}
                {{ form_label(registrationForm.agreeTerms) }}
                {{ form_errors(registrationForm.agreeTerms) }}
            </div>

            <button type="submit" class="btn btn-primary w-100">
                Créer mon compte
            </button>

            {{ form_end(registrationForm) }}

        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle password visibility
    const toggleBtns = document.querySelectorAll('.toggle-password');
    toggleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const input = this.closest('.input-group').querySelector('input');
            const icon = this.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        });
    });
    
    // Password strength checker
    const passwordInput = document.getElementById('password');
    const strengthBar = document.getElementById('password-strength-bar');
    const strengthText = document.getElementById('password-strength-text');
    
    if (passwordInput) {
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            
            // Check password strength
            if (password.length >= 8) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            if (/[^A-Za-z0-9]/.test(password)) strength += 25;
            
            // Update progress bar
            strengthBar.style.width = strength + '%';
            
            // Update text and color
            if (strength < 25) {
                strengthBar.className = 'progress-bar bg-danger';
                strengthText.textContent = 'Très faible';
            } else if (strength < 50) {
                strengthBar.className = 'progress-bar bg-warning';
                strengthText.textContent = 'Faible';
            } else if (strength < 75) {
                strengthBar.className = 'progress-bar bg-info';
                strengthText.textContent = 'Moyen';
            } else {
                strengthBar.className = 'progress-bar bg-success';
                strengthText.textContent = 'Fort';
            }
        });
    }
    
    // Form validation
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const password = document.querySelector('input[name="password"]').value;
            const confirmPassword = document.querySelector('input[name="confirm_password"]').value;
            const terms = document.getElementById('terms');
            
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('Les mots de passe ne correspondent pas');
                return false;
            }
            
            if (!terms.checked) {
                e.preventDefault();
                alert('Vous devez accepter les conditions générales');
                return false;
            }
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Création en cours...';
                submitBtn.disabled = true;
            }
        });
    }
});
</script>
{% endblock %}